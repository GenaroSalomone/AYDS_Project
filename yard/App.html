<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: App
  
    &mdash; Documentation by YARD 0.9.34
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "App";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (A)</a> &raquo;
    
    
    <span class="title">App</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: App
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Sinatra::Application</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sinatra::Application</li>
          
            <li class="next">App</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>ServerConstants</dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>server.rb</dd>
  </dl>
  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#current_user-instance_method" title="#current_user (instance method)">#<strong>current_user</strong>  &#x21d2; User<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current user based on the session.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fetch_question-instance_method" title="#fetch_question (instance method)">#<strong>fetch_question</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Method for fetching a trivia question or a translated trivia question.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_claim-instance_method" title="#get_claim (instance method)">#<strong>get_claim</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for displaying the claim page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_error-instance_method" title="#get_error (instance method)">#<strong>get_error</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for displaying an error page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_protected_page-instance_method" title="#get_protected_page (instance method)">#<strong>get_protected_page</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for displaying the protected page if the user is authenticated.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_question-instance_method" title="#get_question (instance method)">#<strong>get_question</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for handling displaying a trivia question.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_question_traduce-instance_method" title="#get_question_traduce (instance method)">#<strong>get_question_traduce</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for handling displaying a translated trivia question.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_root-instance_method" title="#get_root (instance method)">#<strong>get_root</strong>  &#x21d2; ERB </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint to displays the home page.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_supported_languages-instance_method" title="#get_supported_languages (instance method)">#<strong>get_supported_languages</strong>  &#x21d2; JSON </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET endpoint for obtaining supported languages.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#post_claim-instance_method" title="#post_claim (instance method)">#<strong>post_claim</strong>  &#x21d2; Redirect </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST endpoint for handling user claims submission.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_email-instance_method" title="#send_email (instance method)">#<strong>send_email</strong>(user_id, description, email_ayds)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send an email to managers app.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="current_user-instance_method">
  
    #<strong>current_user</strong>  &#x21d2; <tt>User</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current user based on the session.</p>

<p>This method finds and returns the User object associated with the current session. If there is no user_id in the session, it returns nil.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>User</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The User object if there is a user_id in the session, or nil if there isn’t.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>User#find</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 284</span>

<span class='kw'>def</span> <span class='id identifier rubyid_current_user'>current_user</span>
  <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fetch_question-instance_method">
  
    #<strong>fetch_question</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p>
<p>Method for fetching a trivia question or a translated trivia question.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The index of the question to fetch.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>translated</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A flag indicating whether to fetch a translated question.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/trivia’ if there’s no active trivia session.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/results’ or ‘/results-traduce’ if there are no more questions or if the trivia is complete.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/error?code=unanswered’ if the user tries to access questions out of order.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Trivia#questions</li>
    
      <li>Trivia#translated_questions</li>
    
      <li>Answer.where</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 303</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fetch_question'>fetch_question</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='id identifier rubyid_translated'>translated</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/trivia</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='ivar'>@trivia</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_previous_index'>previous_index</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>?</span> <span class='int'>0</span> <span class='op'>:</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>-</span> <span class='int'>1</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_index'>index</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>||</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:answered_questions</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_previous_index'>previous_index</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_question'>question</span> <span class='op'>=</span> <span class='id identifier rubyid_translated'>translated</span> <span class='op'>?</span> <span class='ivar'>@trivia</span><span class='period'>.</span><span class='id identifier rubyid_translated_questions'>translated_questions</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='ivar'>@trivia</span><span class='period'>.</span><span class='id identifier rubyid_questions'>questions</span><span class='lbracket'>[</span><span class='id identifier rubyid_index'>index</span><span class='rbracket'>]</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_question'>question</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id identifier rubyid_translated'>translated</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;=</span> <span class='const'>TRANSLATEDS_QUESTIONS</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id identifier rubyid_translated'>translated</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_index'>index</span> <span class='op'>&gt;=</span> <span class='const'>QUESTIONS_SPANISH</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect'>redirect</span> <span class='id identifier rubyid_translated'>translated</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/results-traduce</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/results</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
      <span class='ivar'>@question</span> <span class='op'>=</span> <span class='id identifier rubyid_translated'>translated</span> <span class='op'>?</span> <span class='id identifier rubyid_question'>question</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>question</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='id identifier rubyid_question'>question</span>
      <span class='ivar'>@answers</span> <span class='op'>=</span> <span class='const'>Answer</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>question_id:</span> <span class='ivar'>@question</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>id</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='ivar'>@time_limit_seconds</span> <span class='op'>=</span> <span class='ivar'>@trivia</span><span class='period'>.</span><span class='id identifier rubyid_difficulty'>difficulty</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>beginner</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='const'>TIME_BEGINNER</span> <span class='op'>:</span> <span class='const'>TIME_DIFFICULTY</span>
      <span class='ivar'>@question_index</span> <span class='op'>=</span> <span class='id identifier rubyid_index'>index</span>
      <span class='ivar'>@help</span> <span class='op'>=</span> <span class='ivar'>@trivia</span><span class='period'>.</span><span class='id identifier rubyid_difficulty'>difficulty</span><span class='period'>.</span><span class='id identifier rubyid_level'>level</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>beginner</span><span class='tstring_end'>&#39;</span></span> <span class='op'>?</span> <span class='ivar'>@question</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>help</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>nil</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/error?code=unanswered</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_claim-instance_method">
  
    #<strong>get_claim</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for displaying the claim page</p>

<p>This route displays the claim page when a user visits ‘/claim’. It renders the ERB template :claim, which contains the content for the claim page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The claim page content.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 116</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/claim</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:claim</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_error-instance_method">
  
    #<strong>get_error</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for displaying an error page.</p>

<p>This route is responsible for displaying an error page with a specific error message based on the error code and reason. It handles various error scenarios, such as unanswered questions, answered questions, registration errors, login authentication failure, etc.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>code</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The error code indicating the type of error.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reason</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The reason for the error (optional).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Displays an error page with a custom error message.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 213</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/error</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>

  <span class='comment'># Diccionario o hash que mapea error_code y error_reason a mensajes (Key =&gt; Value)
</span>  <span class='id identifier rubyid_error_messages'>error_messages</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unanswered</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Se intentó acceder directamente a una pregunta sin haber respondido la pregunta anterior.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>answered</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>La pregunta ya ha sido respondida.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>registration</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password_mismatch</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Las contraseñas no coinciden.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>registration_error</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ha ocurrido un error durante el registro: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:error_message</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>username_taken</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>El nombre de usuario no está disponible.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>email_taken</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>El email no está disponible.</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>login</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>authenticate_failed</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>El usuario o la contraseña no coinciden. Por favor, vuelva a intentarlo.</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>claim</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>failed_send_claim</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No se pudo enviar su reclamo o valoración.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>malicious_block</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Se detectó código malicioso, el texto no fue enviado.</span><span class='tstring_end'>&#39;</span></span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>

  <span class='id identifier rubyid_error_code'>error_code</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:code</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_error_reason'>error_reason</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:reason</span><span class='rbracket'>]</span>

  <span class='ivar'>@error_message</span> <span class='op'>=</span> <span class='id identifier rubyid_error_messages'>error_messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_error_code'>error_code</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Ha ocurrido un error.</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># si error_code es un sub hash del hash error_messages y error_code es una clave en el hash error_messages
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_error_messages'>error_messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_error_code'>error_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_error_messages'>error_messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_error_code'>error_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_error_reason'>error_reason</span><span class='rparen'>)</span>
    <span class='ivar'>@error_message</span> <span class='op'>=</span> <span class='id identifier rubyid_error_messages'>error_messages</span><span class='lbracket'>[</span><span class='id identifier rubyid_error_code'>error_code</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_error_reason'>error_reason</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:error</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>error_message:</span> <span class='ivar'>@error_message</span> <span class='rbrace'>}</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_protected_page-instance_method">
  
    #<strong>get_protected_page</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for displaying the protected page if the user is authenticated.</p>

<p>This route displays the protected page if the user is authenticated. It checks if there is a user ID stored in the session, retrieves the user’s username, and displays the protected page along with the rankings for different difficulty levels.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The protected page with rankings if the user is authenticated.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/login’ if the user is not authenticated.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>User#find</li>
    
      <li>Difficulty#find_by</li>
    
      <li>Ranking#where</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 92</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected_page</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
    <span class='ivar'>@username</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span>

    <span class='id identifier rubyid_beginner_difficulty'>beginner_difficulty</span> <span class='op'>=</span> <span class='const'>Difficulty</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>level:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>beginner</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_difficult_difficulty'>difficult_difficulty</span> <span class='op'>=</span> <span class='const'>Difficulty</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>level:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>difficult</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

    <span class='id identifier rubyid_beginner_ranking'>beginner_ranking</span> <span class='op'>=</span> <span class='const'>Ranking</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>difficulty_id:</span> <span class='id identifier rubyid_beginner_difficulty'>beginner_difficulty</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>score:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_difficult_ranking'>difficult_ranking</span> <span class='op'>=</span> <span class='const'>Ranking</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>difficulty_id:</span> <span class='id identifier rubyid_difficult_difficulty'>difficult_difficulty</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='label'>score:</span> <span class='symbol'>:desc</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:protected_page</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span> <span class='label'>beginner_ranking:</span> <span class='id identifier rubyid_beginner_ranking'>beginner_ranking</span><span class='comma'>,</span> <span class='label'>difficult_ranking:</span> <span class='id identifier rubyid_difficult_ranking'>difficult_ranking</span> <span class='rbrace'>}</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/login</span><span class='tstring_end'>&#39;</span></span> <span class='comment'># Usuario no autenticado, redirigir a la página de inicio de sesión
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_question-instance_method">
  
    #<strong>get_question</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for handling displaying a trivia question.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The index of the question to display.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The question view for the specified trivia question.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/results’ if there are no more questions or if the trivia is complete.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/error?code=unanswered’ if the user tries to access questions out of order.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#fetch_question-instance_method" title="App#fetch_question (method)">#fetch_question</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


165
166
167
168
169
170
171
172
173
174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 165</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/question/:index</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_fetch_question'>fetch_question</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:question</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span>
    <span class='label'>question:</span> <span class='ivar'>@question</span><span class='comma'>,</span>
    <span class='label'>trivia:</span> <span class='ivar'>@trivia</span><span class='comma'>,</span>
    <span class='label'>question_index:</span> <span class='ivar'>@question_index</span><span class='comma'>,</span>
    <span class='label'>answers:</span> <span class='ivar'>@answers</span><span class='comma'>,</span>
    <span class='label'>time_limit_seconds:</span> <span class='ivar'>@time_limit_seconds</span><span class='comma'>,</span>
    <span class='label'>help:</span> <span class='ivar'>@help</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_question_traduce-instance_method">
  
    #<strong>get_question_traduce</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for handling displaying a translated trivia question.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>index</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The index of the translated question to display.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The translated question view for the specified trivia question.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/results-traduce’ if there are no more translated questions or if the trivia is complete.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects to ‘/error?code=unanswered’ if the user tries to access translated questions out of order.</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#fetch_question-instance_method" title="App#fetch_question (method)">#fetch_question</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 189</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/question-traduce/:index</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_index'>index</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:index</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_fetch_question'>fetch_question</span><span class='lparen'>(</span><span class='id identifier rubyid_index'>index</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:question_traduce</span><span class='comma'>,</span> <span class='label'>locals:</span> <span class='lbrace'>{</span>
    <span class='label'>question:</span> <span class='ivar'>@question</span><span class='comma'>,</span>
    <span class='label'>trivia:</span> <span class='ivar'>@trivia</span><span class='comma'>,</span>
    <span class='label'>question_index:</span> <span class='ivar'>@question_index</span><span class='comma'>,</span>
    <span class='label'>answers:</span> <span class='ivar'>@answers</span><span class='comma'>,</span>
    <span class='label'>time_limit_seconds:</span> <span class='ivar'>@time_limit_seconds</span><span class='comma'>,</span>
    <span class='label'>help:</span> <span class='ivar'>@help</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_root-instance_method">
  
    #<strong>get_root</strong>  &#x21d2; <tt>ERB</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint to displays the home page.</p>

<p>This route is used to show the web application’s home page when a user visits it.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>ERB</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The home page template.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 74</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:index</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_supported_languages-instance_method">
  
    #<strong>get_supported_languages</strong>  &#x21d2; <tt>JSON</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET endpoint for obtaining supported languages.</p>

<p>This method reads data from a local JSON file and returns a list of supported languages. If the data cannot be loaded, it returns an error message.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>JSON</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The list of supported languages.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>StandardError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If there is an error reading the file or parsing the JSON, it returns a 500 status code and an error message.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 257</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/obtener-lenguajes-soportados</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='comment'># Lee los datos desde el archivo JSON local
</span>  <span class='id identifier rubyid_languages_data'>languages_data</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>languages.json</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_languages_data'>languages_data</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='int'>500</span>
    <span class='id identifier rubyid_body'>body</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Error al obtener la lista de lenguajes: No se pudieron cargar los datos.</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='comment'># Define el contenido de la respuesta JSON
</span>    <span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:json</span>
    <span class='id identifier rubyid_status'>status</span> <span class='int'>200</span>
    <span class='id identifier rubyid_body'>body</span> <span class='id identifier rubyid_languages_data'>languages_data</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>data</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>languages</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
  <span class='kw'>end</span>
<span class='kw'>rescue</span> <span class='const'>StandardError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='id identifier rubyid_status'>status</span> <span class='int'>500</span>
  <span class='id identifier rubyid_body'>body</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error al obtener la lista de lenguajes: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="post_claim-instance_method">
  
    #<strong>post_claim</strong>  &#x21d2; <tt>Redirect</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST endpoint for handling user claims submission.</p>

<p>This route handles the submission of user claims when a POST request is made to ‘/claim’. It retrieves the user’s ID from the session and the description text from the form data. Then the input description is sanitize, this is for some extern attack of malintentioned code. If input was remove then redirect to an error page. If input wasn’t remove then creates a new claim record in data base with the provided sanitize description and user ID. If the record was successfully stored then an email was sent to the app managers with the inupt description user.</p>

<p>if not redirects to a error page.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Redirect</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Redirects the user to the protected page if the claim is successfully saved,</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li>Claim#create</li>
    
      <li>Claim#save</li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 135</span>

<span class='id identifier rubyid_post'>post</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/claim</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_user_id'>user_id</span> <span class='op'>=</span> <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:user_id</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_description_text'>description_text</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:description</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_cleaned_description'>cleaned_description</span> <span class='op'>=</span> <span class='const'>Sanitize</span><span class='period'>.</span><span class='id identifier rubyid_fragment'>fragment</span><span class='lparen'>(</span><span class='id identifier rubyid_description_text'>description_text</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_cleaned_description'>cleaned_description</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_status'>status</span> <span class='int'>302</span>
    <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/error?code=claim&amp;reason=malicious_block</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_claim'>claim</span> <span class='op'>=</span> <span class='const'>Claim</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>description:</span> <span class='id identifier rubyid_cleaned_description'>cleaned_description</span><span class='comma'>,</span> <span class='label'>user_id:</span> <span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_claim'>claim</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
      <span class='id identifier rubyid_send_email'>send_email</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_cleaned_description'>cleaned_description</span><span class='comma'>,</span> <span class='id identifier rubyid_email_ayds'>email_ayds</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/protected_page</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_status'>status</span> <span class='int'>302</span>
      <span class='id identifier rubyid_redirect'>redirect</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/error?code=claim&amp;reason=failed_send_claim</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_email-instance_method">
  
    #<strong>send_email</strong>(user_id, description, email_ayds)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send an email to managers app</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


323
324
325
326
327
328
329
330
331
332
333
334
335
336
337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'server.rb', line 323</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_email'>send_email</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='comma'>,</span> <span class='id identifier rubyid_description'>description</span><span class='comma'>,</span> <span class='id identifier rubyid_email_ayds'>email_ayds</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_user_id'>user_id</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_username'>username</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span>
  <span class='id identifier rubyid_user_email'>user_email</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>
  <span class='id identifier rubyid_email_one'>email_one</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EMAIL_ONE</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_email_two'>email_two</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>EMAIL_TWO</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_email_managgers'>email_managgers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_email_one'>email_one</span><span class='comma'>,</span> <span class='id identifier rubyid_email_two'>email_two</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_username'>username</span><span class='embexpr_end'>}</span><span class='tstring_content'> with email </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user_email'>user_email</span><span class='embexpr_end'>}</span><span class='tstring_content'> says:\n\n</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_description'>description</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Mail</span><span class='period'>.</span><span class='id identifier rubyid_deliver'>deliver</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_from'>from</span> <span class='id identifier rubyid_email_ayds'>email_ayds</span>
    <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_email_managgers'>email_managgers</span>
    <span class='id identifier rubyid_subject'>subject</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>New message of AYDS Project App.</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_body'>body</span> <span class='id identifier rubyid_message'>message</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Nov  5 18:14:13 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-2.7.5).
</div>

    </div>
  </body>
</html>